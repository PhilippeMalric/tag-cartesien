
<!-- Toolbar Material -->
<mat-toolbar color="primary">
  <button mat-icon-button matTooltip="Basculer clair/sombre" (click)="theme.toggle()">
    <span class="material-symbols-outlined">dark_mode</span>
  </button>
  <button mat-icon-button aria-label="Retour au lobby" (click)="exitToLobby()">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <span style="margin-left:8px">Match: <strong>{{ matchId }}</strong></span>

  <span class="spacer" style="flex:1 1 auto"></span>

  <mat-chip-set aria-label="Statut de la manche" style="margin-right:8px">
     <mat-chip>Mode: {{ roomMode }}</mat-chip>  
    <mat-chip [disabled]="!role">Rôle: {{ role || '...' }}</mat-chip>
    <mat-chip>Score: {{ myScore }}<ng-container *ngIf="targetScore"> / {{ targetScore }}</ng-container></mat-chip>
    <mat-chip *ngIf="timeLeft >= 0">Temps: {{ timeLeft }}s</mat-chip>
  </mat-chip-set>
</mat-toolbar>
@if (showRecentTag) {
  <div class="tag-toast" role="status" aria-live="polite">
    <mat-icon fontSet="material-symbols-outlined">bolt</mat-icon>
    {{ recentTag!.label }}
  </div>
}
<!-- Progress de déplacement -->
<mat-progress-bar mode="determinate" [value]="moveProgress"></mat-progress-bar>

<!-- Debug overlay -->


<!-- Canvas plein écran sous la toolbar (64px) + progress (4px) -->
<div style="height:calc(100vh - 64px - 4px);display:flex;flex-direction:column;">
  <canvas #canvas style="flex:1;width:100%;height:100%;display:block;background:var(--canvas-bg);"></canvas>
</div>

<div >
  <app-mobile-dpad
    [releaseFn]="onDpadRelease.bind(this)"
    [moveFn]="onDpadMove.bind(this)">
  </app-mobile-dpad>
</div>

<div class="drag drag--score" cdkDrag cdkDragBoundary="body">
  <app-scoreboard-overlay [roomId]="matchId"></app-scoreboard-overlay>
</div>

<div class="drag drag--score" cdkDrag cdkDragBoundary="body"
      style="position:absolute;right:8px;top:96px;padding:6px 8px;background:#0008;color:#fff;
            border-radius:6px;font:12px/1.2 monospace;z-index:5">
  uid: {{debug.uid}}<br>
  match: {{debug.match}}<br>
  pos.uids: {{debug.posUids.join(',') || '∅'}}
</div>